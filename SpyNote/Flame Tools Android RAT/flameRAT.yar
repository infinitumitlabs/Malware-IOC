rule flameRAT_Android_Yara_Rule{
    meta: 
             description = "Yara rule for detecting Flame Tools Android RAT and variants"
             author = "Aziz Kaplan"
             email = "aziz.kaplan@infinitumit.com.tr"
             date = "2024-01-06"
             attack_ip = "193.27.90.130"
             proxy_server = "aksakal.tc"
             domain = "burcakalcak.local"
             attacker_website = "flame-tools.org"
             hash_apk = "544a27b1adbad0abfe28f13b08e6c1327623b8e73b53df2e78bb3f44139b611e"
             hash_dex = "8ba74fc5e864f572da5d5b67594b8f7e44f14d3cb63252dc4d6142a022a4a403"
             variant = "SpyNote"
             threat_actor = “APT34”
             threat_category = "Trojan/Spyware"
    strings:
              $1_ = {63 6C 61 73 73 65 73 2E 64 65 78 } 
              $2_ = {63 50 4B 01 02 14 00 14 00 00 08 08 00 D9 95 72 57 FA} 
              $3_ = {A4 02 00 00 80 07 00 00 43 00 00 00 00 00 00 00 00 00} 
              $4_ = {6F 6C 62 61 72 2E 78 6D 6C 50 4B 01 02} 
              $5_ = {A7 22 2E 00 63 6C 61 73 73 65 73 2E 64 65 78 2F 6C}
              $6_ = {6C 2F 78 6D 6C 2F 61 63 63 65 73 73} 
              $7_ = {86 62 2E 00 63 6C 61 73 73 65 73 2E 64 65 78 2F 72 61 77 2F} 
              $8_ = {6C 65 63 74 5F 64 69 61 6C 6F 67 5F 73 69 6E 67 6C 65 63 68 6F}
              $9_ = {F0 03 70 1F FC 0E F8 73 F0 CC 33 48 87 DF 0A }
              $10 = {36 C5 6C 6C 83 6D 31 0F 3B 60 47 EC 84 F9 D8 19 BB 60 57 EC}
              $11 = {CA 29 3C AA 8B C0 ED 3E   54 2E EF 42 05 A2 BF F2 } 
              $12 = {B5 7E 4D 75} 
              $13 = {4C 69 76 65 20 6C 6F 63 61 74 69 6F 6E 00 25 25 43 6F 75 6C 64 6E 27 74} 
              $14 = {6E 6F 20 6C 6F 6E 67 65 72 20 61 6E 20 61 64 6D 69 6E 20 6F 66 20 74 68} 
              $15 = {63 6C 61 73 73 65 73 2E 64 65 78} 
              $16 = {63 61 6E 20 73 65 6E 64 20 61 6E 64 20 72 65 63 65 69 76 65 20 53 4D 53} 
              $17 = {D1 2E D1 83 6D C8 97 DD EF EC 8D 61 87} 
              $18 = {6C 6C 00 0A 0A 62 75 74 74 6F 6E 54} 
              $19 = {33 32 2E 30 2E 30 2E 30 2F 33} // 32.0.0.0/3
              $20 = {31 32 2E 30 2E 30 2E 30 2F 36} // 12.0.0.0/6
              $21 = {38 2E 30 2E 30 2E 30 2F 37} // 8.0.0.0/7
              $22 = {31 31 2E 30 2E 30 2E 30 2F 38} // 11.0.0.0/8
              $23 = {34 2E 30 2E 30 2E 30 2F 36} // 4.0.0.0/6
              $24 = {39 36 2E 30 2E 30 2E 30 2F 36}
              $25 = {36 34 2E 30 2E 30 2E 30 2F 33} 
              $26 = {31 2E 30 2E 30 2E 30 2F 38}
              $27 = {32 2E 30 2E 30 2E 30 2F 37}
              $28 = {31 30 30 2E 30 2E 30 2E 30 2F 31 30}
              $29 = {50 4B 03 04} 
              $30 = {00 41 6E 64 72 6F 69 64 4D 61 6E 69 66 65 73 74 2E 78 6D 6C}
              $31 = {52 45 41 6E 64 72 6F 69 64 2F 41 50 4B 45 64 69 74 6F 72}
    condition:
        $29 and $30 and filesize < 5MB and 18 of them
}

