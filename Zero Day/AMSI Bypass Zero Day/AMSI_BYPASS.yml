title: AMSI Bypass Zero Day Attack
id: 61d0475c-173f-4244-86f7-f3eebae1a66b

status: test
description: Detects the new AMSI Bypass Zero Day Attack
references:
    - https://github.com/infinitumitlabs/
    - https://infinitumit.com.tr
    - https://www.linkedin.com/company/infinitumlabs
author: Aziz Kaplan <aziz.kaplan@infinitumit.com.tr>
date: 2024/05/05
modified: 2024/05/06
tags:
    - attack.execution
    - attack.t1059.001
logsource:
    product: windows
    category: ps_script
detection:
    selection_cmdlet:
        ScriptBlockText|contains: 
            - 'currentdomain.getassemblies'
    selection_cmdlet2:
        ScriptBlockText|contains: 
            - 'System.ComponentModel'
    selection_cmdlet3:
        ScriptBlockText|contains: 
            - 'System.Management.Automation'
    selection_cmdlet4:
        ScriptBlockText|contains: 
            - 'System.Reflection'
    selection_cmdlet5:
        ScriptBlockText|contains: 
            - 'System.Runtime.CompilerServices'
    selection_cmdlet6:
        ScriptBlockText|contains: 
            - 'System.Runtime.InteropServices'
    selection_cmdlet7:
        ScriptBlockText|contains: 
            - 'MethodImplOptions.NoOptimization'
    selection_cmdlet8:
        ScriptBlockText|contains: 
            - 'MethodImplOptions.NoInlining'
    selection_cmdlet9:
        ScriptBlockText|contains: 
            - 'System.Reflection.BindingFlags'
    selection_cmdlet10:
        ScriptBlockText|contains: 
            - 'MethodHandle.GetFunctionPointer'
    selection_cmdlet11:
        ScriptBlockText|contains: 
            - 'System.Runtime.InteropServices.Marshal'
    selection_cmdlet12:
        ScriptBlockText|contains: 
            - 'ReadProcessMemory'
    selection_cmdlet13:
        ScriptBlockText|contains: 
            - 'GetCurrentProcess'
    selection_cmdlet14:
        ScriptBlockText|contains: 
            - 'GetModuleHandle'
    selection_cmdlet15:
        ScriptBlockText|contains: 
            - '.replace'
    condition:  all of selection_cmdlet*
falsepositives:
    - Harmless PS1 Activity
level: high
